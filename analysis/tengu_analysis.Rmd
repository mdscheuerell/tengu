---
title: "Shifts in the size of fish from a culturally important recreational fishery"
author: "Mark Scheuerell"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  pdf_document:
    highlight: haddock
fontsize: 11pt
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = "center")

library(dplyr)

## plot hook to increase margins
local({
  hook_old <- knitr::knit_hooks$get("plot")  # save the old hook
  knitr::knit_hooks$set(plot = function(x, options) {
    x <- c("\\vspace{0.5in}", hook_old(x, options))
  })
})

## better captions
library("captioner")
## set default caption delimter
fig_cap <- captioner(suffix = ".", style = "b", style_prefix = TRUE)
```

# Background


# Data

The original data were provided to me by Tom Quinn on 16 June 2020 in the form of an MS Excel file titled `Tengu_derby_leaders through 2019 derby.xls`. I exported the one worksheet of interest (`data in kg`) as `~/data/tengu_derby_data.csv`.

```{r import_data}
## set data dir
datadir <- here::here("data")
## import raw data
raw_data <- readr::read_csv(file.path(datadir, "tengu_derby_data.csv"))
```

## Fishing effort

This dataset lacks the necessary detail to calculate a proper index of the catch per unit effort (CPUE) because effort is ill-defined. That is, although we know the total number of days per year the derby was open and the total number of anglers that participated per year, we don't know how many days *each* angler fished. Therefore, we assumed that each angler fished every day the derby was open, which is almost certainly an overestimate of the true effort, but we have no reason to believe there would be any systematic change over time.

```{r calculate_cpue, fig.dim = c(6, 4)}
## CPUE
cpue <- raw_data$total_catch / (raw_data$days * raw_data$members)

## time series plot of CPUE
par(mai = c(0.9, 0.9, 0.1, 0.1))
plot.ts(ts(cpue, start = min(raw_data$year)), lwd = 2, col = "blue",
        las = 1, log = "y",
        ylab = "CPUE", xlab = "Year", yaxt = "n")
axis(2, at = c(0.01, 0.02, 0.05, 0.1), las = 1)
```

\setlength{\leftskip}{0.5in}
\setlength{\rightskip}{0.5in}

\small

`r fig_cap(1, caption = "Time series of catch per unit effort of blackmouth from the Tengu Derby. Note that the y-axis is on a natural log scale.", display = "full")` 

\normalsize

\setlength{\leftskip}{0in}
\setlength{\rightskip}{0in}


# Analysis

The CPUE appears to generally decline over time, so I fit two random walk models (with and without a bias term) to estimate the data support for a decline. Because CPUE is necessarily bounded by zero at a minimum, I fit models to the log-transformed CPUE. Specifically, the models are

\begin{equation}
c_t = c_{t-1} + u + e_t
\end{equation}

and \begin{equation}
c_t = c_{t-1} + e_t
\end{equation}

where $c_t$ is the log$_e$-transformed CPUE, $u$ is a bias term, and $e_t \sim \text{N}(0, \sigma)$.

## Fit models

```{r fit_cpue_models}
## model setup
mod_list <- list(
  B = matrix(1),
  U = matrix("u"),
  Q = matrix("q"),
  Z = matrix(1),
  A = matrix(0),
  R = matrix(0)
)
yy <- matrix(log(cpue), nrow = 1)

## fit model with bias (Eqn 1)
mod_1 <- MARSS::MARSS(yy, model = mod_list)

## 95% CI for bias
mod_1 <- MARSS::MARSSparamCIs(mod_1)

## fit model without bias (Eqn 2)
mod_list$U <- matrix(0)
mod_2 <- MARSS::MARSS(yy, model = mod_list)
```

\vspace{0.25in}

The 95% confidence interval for the bias term $(u)$ is (`r round(c(mod_1$par.lowCI$U, mod_1$par.upCI$U), 2)`) and the model with a bias term has an AICc value ~2 units greater than the model without a bias term, suggesting there is no data support for a downwrd trend in the CPUE over time.


